apiVersion: crd.chenshaowen.com/v1
kind: Pipeline
metadata:
  name: inspect-error-svc
  namespace: ops-system
spec:
  desc: svc 处于异常状态时，用来查看 svc 的错误日志和错误事件
  variables:
    cluster:
      required: true
    svc:
      required: true
      regex: "[A-Za-z0-9-]+"
    namespace:
      required: true
      regex: "[A-Za-z0-9-]+"
  tasks:
    - name: 检查 svc 是否存在
      taskRef: check-svc-existed
    - name: 获取 Deployment
      taskRef: get-deployment-bysvc
    - name: 查看 svc 错误日志
      taskRef: get-pod-error-logs-bysvc
    - name: 查看 svc 的错误事件
      taskRef: list-error-events-bysvc
