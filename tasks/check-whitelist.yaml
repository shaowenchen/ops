apiVersion: crd.chenshaowen.com/v1
kind: Task
metadata:
  name: check-whitelist
  namespace: ops-system
spec:
  desc: check whitelist
  variables:
    white:
      required: true
      display: white
    whitelist:
      required: true
      display: whitelist
      examples:
        - white1,white2,white3
  steps:
    - name: check whitelist
      content: |
        #!/bin/bash

        white="${white}"
        whitelist="${whitelist}"

        IFS=',' read -r -a whitelist_array <<< "$whitelist"

        found=false
        for item in "${whitelist_array[@]}"; do
          if [[ "$item" == "$white" ]]; then
            found=true
            break
          fi
        done

        if [[ "$found" == true ]]; then
          echo "${white} is in the whitelist."
          exit 0
        else
          echo "${white} is not in the whitelist."
          exit 1
        fi
