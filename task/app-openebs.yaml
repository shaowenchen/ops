apiVersion: crd.chenshaowen.com/v1
kind: Task
metadata:
  name: add-openebs
  namespace: ops-system
spec:
  desc: add openebs
  variables:
    action: apply
    kubeconfig: "/etc/kubernetes/admin.conf"
  steps:
    - name: ${action} openebs
      content: kubectl --kubeconfig ${kubeconfig} ${action} -f https://openebs.github.io/charts/openebs-operator.yaml
    - name: set default class
      content: |+
        kubectl --kubeconfig ${kubeconfig} patch storageclass openebs-hostpath -p '{"metadata": {"annotations":{"storageclass.kubernetes.io/is-default-class":"true"}}}'
      when: ${action}==apply