apiVersion: ops.chenshaowen.com/v1
kind: Task
metadata:
  name: task-sample
  namespace: default
spec:
  desc: Set Docker live-restore
  steps:
    - name: Make Docker Etc Dir
      script: mkdir -p /etc/docker
    - name: Make Daemon.json
      script: test -f /etc/docker/daemon.json || echo '{}' > /etc/docker/daemon.json
    - name: Set Docker live-restore
      script: 'jq ". + {\"live-restore\": true}" <<< $(cat /etc/docker/daemon.json ) > /etc/docker/daemon.json'
    - name: Reload Docker
      script: systemctl reload docker
    - name: Show Docker config
      script: cat /etc/docker/daemon.json
