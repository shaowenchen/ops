apiVersion: crd.chenshaowen.com/v1
kind: Task
metadata:
  name: set-hubimage
  namespace: ops-system
spec:
  desc: Set hubimage
  variables:
    namespace: ops-system
    resource: deployments,daemonsets,statefulsets
  steps:
    - name: replace quay.io/prometheus-operator
      content: kubectl -n ${namespace} get ${resource} -o yaml | sed 's/quay.io\/prometheus-operator/hubimage/g' | kubectl apply -f -
    - name: replace registry.k8s.io/kube-state-metrics
      content: kubectl -n ${namespace} get ${resource} -o yaml | sed 's/registry.k8s.io\/kube-state-metrics/hubimage/g' | kubectl apply -f -
    - name: replace quay.io/prometheus
      content: kubectl -n ${namespace} get ${resource} -o yaml | sed 's/quay.io\/prometheus/hubimage/g' | kubectl apply -f -
    - name: replace prom/blackbox-exporter
      content: kubectl -n ${namespace} get ${resource} -o yaml | sed 's/prom\/blackbox-exporter/hubimage\/blackbox-exporter/g' | kubectl apply -f -
    - name: replace k8s.gcr.io/autoscaling
      content: kubectl -n ${namespace} get ${resource} -o yaml | sed 's/k8s.gcr.io\/autoscaling/hubimage/g' | kubectl apply -f -