apiVersion: crd.chenshaowen.com/v1
kind: Task
metadata:
  name: set-hubimage
  namespace: default
spec:
  desc: Set hubimage
  variables:
    namespace: default
    resource: deployments,daemonsets,statefulsets
  steps:
    - name: replace quay.io/prometheus-operator
      content: kubectl -n ${namespace} get ${resource} -o yaml | sed 's/quay.io\/prometheus-operator/hubimage/g' | kubectl apply -f -
    - name: replace registry.k8s.io/kube-state-metrics
      content: kubectl -n ${namespace} get ${resource} -o yaml | sed 's/registry.k8s.io\/kube-state-metrics/hubimage/g' | kubectl apply -f -
    - name: replace quay.io/prometheus
      content: kubectl -n ${namespace} get ${resource} -o yaml | sed 's/quay.io\/prometheus/hubimage/g' | kubectl apply -f -
