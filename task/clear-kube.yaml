apiVersion: crd.chenshaowen.com/v1
kind: Task
metadata:
  name: clear-kube
  namespace: ops-system
spec:
  crontab: "*/2 * * * *"
  nameRef: dev1
  typeRef: cluster
  desc: clear Kubernetes resource
  steps:
    - name: clear Evicted pod
      content: kubectl get pods --all-namespaces -o wide | grep Evicted | awk '{print $1,$2}' | xargs -L1 kubectl delete pod --grace-period=0 --force -n
      allowfailure: "true"
    - name: clear Error pod
      content: kubectl get pods --all-namespaces -o wide | grep Error | awk '{print $1,$2}' | xargs -L1 kubectl delete pod --grace-period=0 --force -n
      allowfailure: "true"
    - name: clear Completed pod
      content: kubectl get pods --all-namespaces -o wide | grep Completed | awk '{print $1,$2}' | xargs -L1 kubectl delete pod --grace-period=0 --force -n
      allowfailure: "true"
    - name: clear ErrImagePull pod
      content: kubectl get pods --all-namespaces -o wide | grep ErrImagePull | awk '{print $1,$2}' | xargs -L1 kubectl delete pod --grace-period=0 --force -n
      allowfailure: "true"
    - name: clear ImagePullBackOff pod
      content: kubectl get pods --all-namespaces -o wide | grep ImagePullBackOff | awk '{print $1,$2}' | xargs -L1 kubectl delete pod --grace-period=0 --force -n
      allowfailure: "true"
    - name: clear CrashLoopBackOff pod
      content: kubectl get pods --all-namespaces -o wide | grep CrashLoopBackOff | awk '{print $1,$2}' | xargs -L1 kubectl delete pod --grace-period=0 --force -n
      allowfailure: "true"
    - name: clear Terminating pod
      content: kubectl get pods --all-namespaces -o wide | grep Terminating | awk '{print $1,$2}' | xargs -L1 kubectl delete pod --grace-period=0 --force -n
      allowfailure: "true"
