apiVersion: crd.chenshaowen.com/v1
kind: Task
metadata:
  name: clear-docker
  namespace: default
spec:
  crontab: 0 0 22 * * 2
  nameref: prod
  typeref: cluster
  all: true
  desc: Docker Clear
  steps:
    - name: Docker system prune
      script: docker system prune
      allowfailure: "true"
    - name: Clear biz image
      script: docker images |grep -E "([0-9a-z]+[-]){3,}[0-9]{9}" |awk '{print $3}' | xargs /usr/bin/docker rmi
      allowfailure: "true"